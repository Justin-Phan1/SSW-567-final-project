<!DOCTYPE html>
<html>
<head>
    <title>MutPy mutation report - mutation #34</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/bootstrap/3.0.3/css/bootstrap.min.css">
    
<link href="http://alexgorbatchev.com/pub/sh/current/styles/shCore.css" rel="stylesheet" type="text/css" />
<link href="http://alexgorbatchev.com/pub/sh/current/styles/shThemeDefault.css" rel="stylesheet" type="text/css" />

    <script src="https://code.jquery.com/jquery.js"></script>
    <script src="https://netdna.bootstrapcdn.com/bootstrap/3.0.3/js/bootstrap.min.js"></script>
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->
    
<script src="http://alexgorbatchev.com/pub/sh/current/scripts/shCore.js" type="text/javascript"></script>
<script src="http://alexgorbatchev.com/pub/sh/current/scripts/shBrushPython.js" type="text/javascript"></script>
<script type="text/javascript">
    SyntaxHighlighter.all();
    window.setTimeout(function () {
        
        $('.line.number35').attr('title', 'CRP');
        
    }, 0);
</script>

</head>
<body>
    <div class="container">
        
<div class="page-header">
    <h1>Mutation #34</h1>
</div>
<h3>Details</h3>
<ul>
    <li>module - <code><module 'MRTD' from '.\\MRTD.py'></code></li>
    <li><span class="label label-success">killed</span> by <code>MTTDtest.py::TestMRTD::test_decodeMRZ_field_lengths</code></li>
    
    <li>duration - 0.066 s</li>
    
    
    <li>tests run - 2</li>
    
</ul>

<h3>Exception traceback</h3>
<pre>self = <MTTDtest.TestMRTD testMethod=test_decodeMRZ_field_lengths>

    def test_decodeMRZ_field_lengths(self):
        """Verify all expected MRZ fields exist in the output."""
        line1 = "P<UTOERIKSSON<<ANNA<MARIA<<<<<<<<<<<<<<<<<<<"
        line2 = "L898902C36UTO7408122F1204159ZE184226B<<<<<10"
        decoded = self.scanner.decode_mrz_data(line1, line2)
    
        expected_fields = [
            "passport_type", "issuing_country", "surname", "given_names",
            "passport_number", "check_digit_1", "country_code",
            "birth_date", "check_digit_2", "gender", "expiration_date",
            "check_digit_3", "personal_number", "check_digit_4"
        ]
    
        for field in expected_fields:
>           self.assertIn(field, decoded, f"{field} missing from decoded output")
E           AssertionError: 'passport_type' not found in 'Error: Failed to decode MRZ lines (empty separator).' : passport_type missing from decoded output

MTTDtest.py:76: AssertionError</pre>

<h3>Mutations</h3>
<ul>
    
    <li>CRP - line 35</li>
    
</ul>
<h3>Mutant</h3>
<pre class="brush: python; first-line: 1; highlight: [35]; toolbar: false;">class MRTD:
    '''MRTD simulates a system that can scan and decode Machine Readable Travel Documents (MRTDs) such as passports by reading their Machine Readable Zone (MRZ).'''
    def scan_mrz():
        '''
        This function scans the MRZ of a travel document using a hardware device scanner and get the information in MRZ as two strings. 
        This means that you define an empty method for this function is created since we are not require to worry about the implementation 
        of the hardware device, but we need to define this method for our system. 
        '''
        return True
    
    def decode_mrz_data(self, str1, str2):
        '''The system shall be able to separate the two strings obtained from the MRZ into these categories: passport type, issuing country, name of the passport holder, passport number, country code, birth date, gender, expiration date, personal number, and the check digits in between the second line of the MRZ. 
        
        Expected Format:
        Line 1: [Type][Issuing Country][Name]
        Line 2: [Passport Number][Check Digit 1][Country Code]
                [Birth Date][Check Digit 2][Gender]
                [Expiration Date][Check Digit 3]
                [Personal Number][Check Digit 4]

        Returns a dictionary with the extracted fields.
        '''
        try:
            
            passport_type = str1[0:2].replace('<', '').strip()
            issuing_country = str1[2:5].replace('<', '').strip()
            
            
            name_field = str1[5:]
            
            
            double_arrow_index = name_field.find('<<')
            
            if 0 <= double_arrow_index < len(name_field) - 5:
                (surname, given_names) = name_field.split('', 1)
                surname = surname.replace('<', ' ').strip()
                given_names = given_names.replace('<', ' ').strip()
                
                
                if (not surname or not given_names):
                    surname = 'Unknown'
                    given_names = 'Unknown'
            else:
                surname = 'Unknown'
                given_names = 'Unknown'
            
            
            passport_number = str2[0:9].replace('<', '')
            check_digit_1 = str2[9]
            country_code = str2[10:13].replace('<', '')
            birth_date = str2[13:19]
            check_digit_2 = str2[19]
            gender = str2[20]
            expiration_date = str2[21:27]
            check_digit_3 = str2[27]
            personal_number = str2[28:42].replace('<', '')
            check_digit_4 = str2[43]
            
            
            decoded_fields = {\
                'passport_type': passport_type, \
                'issuing_country': issuing_country, \
                'surname': surname, \
                'given_names': given_names, \
                'passport_number': passport_number, \
                'check_digit_1': check_digit_1, \
                'country_code': country_code, \
                'birth_date': birth_date, \
                'check_digit_2': check_digit_2, \
                'gender': gender, \
                'expiration_date': expiration_date, \
                'check_digit_3': check_digit_3, \
                'personal_number': personal_number, \
                'check_digit_4': check_digit_4}
            
            
            return decoded_fields
        
        except Exception as e:
            return f'Error: Failed to decode MRZ lines ({str(e)}).'
    
    def encode_mrz_data():
        '''
        The system shall be able to encode travel document information fields queried from a database into the 
        two strings for the MRZ in a travel document. Empty function is defined since we are not required to implement this function.
        '''
        return True
    
    def report_mismatch(passport_number, date_of_birth, expiration_date, personal_number, check_digit_1, check_digit_2, check_digit_3, check_digit_4):
        '''
        This function reports if the check digits in string 2 of the MRZ are wrong
        Input: string passport_number, string date_of_birth, string expiration_date, string personal_number, int check_digit_1, int check_digit_2, int check_digit_3, int check_digit_4
        Output: A string showing if the check digits mismatched or not
        '''
        
        passport_number_adler_checksum = MRTD.adler_32(passport_number) % 10
        date_of_birth__adler_checksum = MRTD.adler_32(date_of_birth) % 10
        expiration_date_adler_checksum = MRTD.adler_32(expiration_date) % 10
        personal_number_adler_checksum = MRTD.adler_32(personal_number) % 10
        
        if check_digit_1 != passport_number_adler_checksum:
            print('Error: Passport number checkdigit does not match.\n')
        else:
            print('Passport number checkdigit matches.\n')
        if check_digit_2 != date_of_birth__adler_checksum:
            print('Error: Date of birth checkdigit does not match.\n')
        else:
            print('Date of birth checkdigit matches.\n')
        if check_digit_3 != expiration_date_adler_checksum:
            print('Error: Expiration date checkdigit does not match.\n')
        else:
            print('Expiration date checkdigit matches.\n')
        if check_digit_4 != personal_number_adler_checksum:
            print('Error: Personal number checkdigit does not match.\n')
        else:
            print('Personal number checkdigit matches.\n')
            return
    
    def adler_32(data):
        '''
        This function utilizes the Adler-32 algorithm to produce a checksum.
        Input: a string of data
        Output: the checksum calculated for that string
        '''
        a = 1
        b = 0
        length = len(data)
        for i in range(0, length):
            a = (a + ord(data[i])) % 65521
            b = (b + a) % 65521
        return (b << 16) | a</pre>

    </div>
</body>
</html>